<ion-content [ngClass]="{'default': !showFeedback(), 'success': showFeedback() && slideInfo[currentSlide].stage == Stage.CORRECT, 'failure': showFeedback() && slideInfo[currentSlide].stage == Stage.INCORRECT}">

  <ion-progress-bar style="margin-top: 0px" value={{progressPercent}}></ion-progress-bar>

  <span *ngIf="!scoreCardDisplayed()">
    <div class="score-banner"><b>Score: {{score}}/{{progressPercent * taskLength}}</b></div>
    <div class="score-change">+1</div>
  </span>

  <div *ngIf="slideInfo[currentSlide].stage == Stage.START" (click)="startMemorizeTimer()" class="overlay" [@fadeInOut]="slideInfo[currentSlide].stage == Stage.START ? 'visible' : 'invisible'" button>
    <div class="overlay-content">
      Tap to reveal
    </div>
  </div>

  <ion-slides #slideElement (ionSlideDidChange)="changeSlide()">

    <ion-slide *ngFor="let slide of slideInfo; let slideIndex = index" class="flex-slide">

      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.START">Memorize the face: {{memorizeTime}}</div>
      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.MEMORIZE">Memorize the face: <span [@countdown]="timeRemaining % 2 == 0 ? 'active' : 'inactive'" class="time-left">{{timeRemaining}}</span></div>
      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.MASK">Hold the face in your mind...</div>
      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.SELECT">Is this the same person?</div>
      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.CORRECT">Correct!</div>
      <div class="prompt" *ngIf="slideInfo[slideIndex].stage == Stage.INCORRECT">Incorrect!</div>

      <div *ngIf="slideInfo[slideIndex].stage != Stage.CORRECT && slideInfo[slideIndex].stage != Stage.INCORRECT" class="flipper" [@swipeCard]="slideInfo[slideIndex].selection == true ? 'left' : 'right'" (pan)="drag($event)" (panend)="returnCenter($event)">
        <div class="front">
          <ion-icon *ngIf="slideInfo[slideIndex].stage == Stage.SELECT" (click)="selectFace(true)" color="dark" name="arrow-back" style="font-size: 150%"></ion-icon>
          <img *ngIf="slideInfo[slideIndex].stage != Stage.START" [src]="getSrc(slideIndex)" style="height: 270px; border-radius: 10%;"/>
          <ion-icon *ngIf="slideInfo[slideIndex].stage == Stage.SELECT" (click)="selectFace(false)" color="dark" name="arrow-forward" style="font-size: 150%"></ion-icon>
        </div>
        <div class="back">
          <img [src]="mask" style="height: 270px; width: 85%; border-radius: 10%; backface-visibility: hidden"/>
        </div>
      </div>

      <div *ngIf="slideInfo[slideIndex].stage == Stage.CORRECT || slideInfo[slideIndex].stage == Stage.INCORRECT" style="width: 100%; display: flex; flex-direction: column; justify-content: center">
        <div *ngIf="slideInfo[slideIndex].correctFace == slideInfo[slideIndex].displayedFace" class="subheader">Same</div>
        <div *ngIf="slideInfo[slideIndex].correctFace != slideInfo[slideIndex].displayedFace" class="subheader">Different</div>
        <div>
          <ion-card class="grid-card" style="--background: gainsboro;">
            <img [src]="slideInfo[slideIndex].correctFace">
          </ion-card>
          <ion-card class="grid-card" style="--background: gainsboro;">
            <img [src]="slideInfo[slideIndex].displayedFace">
          </ion-card>
        </div>
      </div>

      <div *ngIf="slideInfo[slideIndex].stage == Stage.SELECT" [@fadeFooter]="slideInfo[slideIndex].stage == Stage.SELECT ? 'sameDifferent' : 'invisible'" class="swipe-footer">
        <ion-button (click)="selectFace(true)" color="primary">Same</ion-button>
        <ion-button (click)="selectFace(false)" color="secondary">Different</ion-button>
      </div>

      <ion-item *ngIf="slideInfo[slideIndex].stage != Stage.SELECT" [@fadeFooter]="showFeedback() ? 'visible' : 'invisible'" class="footer" lines="none">
        <ion-label>Swipe to Continue</ion-label>
        <ion-icon slot="end" color="dark" name="arrow-back"></ion-icon>    
      </ion-item>

    </ion-slide>

   <!--Score page-->
    <ion-slide>
      <app-score-page [score]="score" [length]="taskLength" [assessment]="true" (finished)="finished.emit([score, 2])"></app-score-page>
    </ion-slide>

  </ion-slides>

</ion-content>
